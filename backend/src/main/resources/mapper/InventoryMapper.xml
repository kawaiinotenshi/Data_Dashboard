<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.logistics.mapper.InventoryMapper">

    <resultMap id="BaseResultMap" type="com.logistics.entity.Inventory">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="enterprise_name" property="enterpriseName" jdbcType="VARCHAR"/>
        <result column="ratio" property="ratio" jdbcType="DECIMAL"/>
        <result column="month" property="month" jdbcType="VARCHAR"/>
        <result column="created_time" property="createdTime" jdbcType="TIMESTAMP"/>
        <result column="updated_time" property="updatedTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <select id="selectInventoryStatistics" resultType="java.util.Map">
        SELECT 
            COUNT(*) as totalCount,
            SUM(ratio) as totalRatio,
            AVG(ratio) as avgRatio,
            MAX(ratio) as maxRatio,
            MIN(ratio) as minRatio,
            COUNT(DISTINCT month) as monthCount
        FROM inventory_ratio
    </select>

    <select id="selectInventoryByMonth" resultMap="BaseResultMap">
        SELECT * FROM inventory_ratio
        WHERE month = #{month}
        ORDER BY ratio DESC
    </select>

    <select id="selectInventoryByEnterpriseRanking" resultType="java.util.Map">
        SELECT 
            enterprise_name,
            AVG(ratio) as avgRatio,
            MAX(ratio) as maxRatio,
            MIN(ratio) as minRatio,
            COUNT(*) as recordCount
        FROM inventory_ratio
        GROUP BY enterprise_name
        ORDER BY avgRatio DESC
    </select>

    <select id="selectInventoryByEnterpriseRatio" resultType="java.util.Map">
        SELECT 
            enterprise_name,
            ratio,
            month
        FROM inventory_ratio
        ORDER BY ratio DESC
    </select>

    <select id="selectInventoryTrend" resultType="java.util.Map">
        SELECT 
            month,
            SUM(ratio) as totalRatio,
            AVG(ratio) as avgRatio,
            COUNT(*) as enterpriseCount
        FROM inventory_ratio
        GROUP BY month
        ORDER BY month ASC
    </select>

</mapper>